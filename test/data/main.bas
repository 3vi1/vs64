90 IFDISPLAY=$0400THENMEM:CSET1:PRINT"WAIT...":LOAD"SOKOBAN.CHR",0,0,$EC00
100 DIV:CHECK:INIT
110 LOOP:EXITIFX$="X"
120 SETZEN:END LOOP
999 END
3000 PROC FELD
3010 PRINTAT0,0)DUP(CHR$(160),40);
3020 PRINTAT0,0)"";:CENTRE"ÓÏËÏÂÁÎ"+STR$(P)
3025 PK=0:FORI=1TOH:FORJ=1TOB:READX:F%(J,I)=X:G%(J,I)=X
3030 IF X=0 THEN K0
3035 IF X=1 THEN K1
3040 IF X=2 THEN K2
3050 IF X=3 THEN K3
3060 IF X=4 THEN K4
3070 IF X=5 THEN K5:G%(J,I)=2:PK=PK+1
3075 IF X=$88 THEN K5:F%(J,I)=5:G%(J,I)=3:PK=PK+1:IN=IN+1
3080 IF X=6 THEN K6
3090 IF X=7 THEN K7
3100 IF X=8 THEN K8
3110 IF X=9 THEN K9:F%(J,I)=2:G%(J,I)=2
3112 IF X=12THEN K9:F%(J,I)=3:G%(J,I)=3
3115 IF X=10THEN KA
3120 S=S+2:NEXT:S=OX:Z=Z+2:NEXT:Z=SY*2-OY:S=(SX-1)*2+OX
3130 END PROC
3200 PROC AUF
3210 Z=Z-2: I=Z/2+OY: J=S/2+1: M1=F%(J,I): M2=F%(J,I+1)
3215 IF M1=5 THEN PAUF
3217 IF M1=2 THEN IF M2=3 THEN K9: Z=Z+2: K3: Z=Z-2: END PROC
3220 IF M1=2 THEN K9: Z=Z+2: K2: Z=Z-2: END PROC
3230 IF M1=3 THEN IF M2=3 THEN K9: Z=Z+2: K3: Z=Z-2: END PROC
3235 IF M1=3 THEN IF M2=2 THEN K9: Z=Z+2: K2: Z=Z-2: END PROC
3240 IF M1<>2 THEN Z=Z+2: K9
3245 END PROC
3250 PROC AB
3260 Z=Z+2: I=Z/2+OY: J=S/2+1: M1=F%(J,I): M2=F%(J,I-1)
3265 IF M1=5 THEN PAB
3267 IF M1=2 THEN IF M2=3 THEN K9: Z=Z-2: K3: Z=Z+2: END PROC
3270 IF M1=2 THEN K9: Z=Z-2: K2: Z=Z+2: END PROC
3275 IF M1=3 THEN IF M2=2 THEN K9: Z=Z-2: K2: Z=Z+2: END PROC
3280 IF M1=3 THEN IF M2=3 THEN K9: Z=Z-2: K3: Z=Z+2: END PROC
3285 IF M1<>2 THEN Z=Z-2: K9
3290 END PROC
3300 PROC NR
3310 I=Z/2+OY: J=S/2+1: M1=F%(J,I): M2=F%(J+1,I)
3315 IF M2=5 THEN PNR
3320 IF M1=3 THEN IF (M2=2) OR (M2=3) THEN K3: S=S+2: K9
3325 IF M1=2 THEN IF (M2=2) OR (M2=3) THEN K2: S=S+2: K9
3340 END PROC
3350 PROC NL
3360 I=Z/2+OY: J=(S-2)/2+1: M1=F%(J,I): M2=F%(J+1,I)
3365 IF M1=5 THEN PNL
3370 IF M2=2 THEN IF (M1=2) OR (M1=3) THEN K2: S=S-2: K9
3375 IF M2=3 THEN IF (M1=2) OR (M1=3) THEN K3: S=S-2: K9
3380 END PROC
3400 PROC PAUF
3405 M3=F%(J,I-1)
3410 IF M3=2THENZ=Z+2:K2:MAUF:IFM2=3THENZ=Z+4:K3:Z=Z-4
3412 IF M3=3THENIFG%(J,I)=2THENIN=IN+1
3415 IFM3=3THENIFM2=2THENZ=Z+2:K2:MAUF
3420 IFM3=3THENIFM2=3THENZ=Z+2:K3:MAUF
3425 END PROC
3430 PROC PAB
3435 M3=F%(J,I+1)
3440 IF M3=2THENZ=Z-2:K2:MAB:IFM2=3THENZ=Z-4:K3:Z=Z+4
3445 IF M3=3THENIFG%(J,I)=2THENIN=IN+1
3447 IF M3=3THENIFM2=2THENZ=Z-2:K2:MAB
3450 IF M3=3THENIFM2=3THENZ=Z-2:K3:MAB
3455 END PROC
3460 PROC PNR
3465 M3=F%(J+2,I)
3470 IFM3=2THENIFM1=3THENK3:MR:END PROC
3472 IFM3=2THENK2:MR
3475 IFM3=3THENIFM1=2THENK2:MR:IFG%(J+1,I)=2THENIN=IN+1
3480 IFM3=3THENIFM1=3THENK3:MR
3485 END PROC
3490 PROC PNL
3500 M3=F%(J-1,I)
3505 IF M3=2THENIFM2=3THENK3:ML:END PROC
3510 IF M3=2 THEN K2: ML:END PROC
3515 IF M3=3THENIFM2=2THENK2:ML:IFG%(J,I)=2THENIN=IN+1
3520 IFM3=3THENIFM2=3THENK3:ML
3525 END PROC
3550 PROC MR
3560 S=S+2: K9: S=S+2: K5: S=S-2: F%(J+1,I)=G%(J+1,I): F%(J+2,I)=5
3570 END PROC
3580 PROC ML
3585 S=S-4: K5: S=S+2: K9: F%(J,I)=G%(J,I): F%(J-1,I)=5
3590 END PROC
3600 PROC MAUF
3610 Z=Z-4: K5: F%(J,I-1)=5: F%(J,I)=G%(J,I)
3620 END PROC
3630 PROC MAB
3640 Z=Z+4 :K5: F%(J,I)=G%(J,I): F%(J,I+1)=5
3650 END PROC
3700 PROC ABLAGE
3705 BFLASH 30,6,12
3710 COLOUR,FS:PRINTAT0,0)"";:CENTRE" ÁÒÅ ÙÏÕ ÆÉÎÉÓÈÅÄ? "
3720 AL=0:COLOUR 6,FB: FORI=1TOH:FORJ=1TOB
3730 X=G%(J,I):IF X=3 THEN X=X+F%(J,I):IF X=8 THEN AL=AL+1
3740 NEXT:NEXT:BFLASH OFF:COLOUR,12
3760 PRINTAT0,0)DUP(" ",40)AT0,0)"";:CENTRE"ÓÏËÏÂÁÎ"+STR$(P)
3790 END PROC
3800 PROC FINISH
3810 PRINTAT0,0)DUP(" ",36)AT0,0)"";:CENTRE" ÙÅÓ, ÙÏÕ ÍÁÄÅ ÉÔ! "
3820 BFLASH 10,5,13:PAUSE2:BFLASH OFF:COLOUR,12
3825 X$="":LOOP:EXITIFPLACE(X$,"XY")
3830 PRINTAT0,0)DUP(" ",36)AT0,0)"";:CENTRE" ÎÅØÔ ÔÁÂÌÅ? (Ù/Î) "
3840 FETCH"YN",1,X$:IFX$="N"THENX$="X"
3845 END LOOP
3850 P=PEEK(2):IFP=NTHENFINALE
3855 IFX$="Y"THENP=P+1:X$="R"
3860 POKE2,P
3870 END PROC
3900 PROC SETZEN
3910 REPEAT:GETX$
3920 IF X$="" THEN AUF
3930 IF X$="" THEN AB
3940 IF X$="" THEN NL
3950 IF X$="" THEN NR
3955 IF IN>=PK THEN ABLAGE: IF IN>AL THEN IN=AL
3965 IF AL=PK THEN X$="X":FINISH
3980 UNTIL PLACE(X$,"XNR")
3985 IFX$="R"THENRUN
3990 IFX$="N"THENP=PEEK(2):P=P+1:POKE2,P:RUN
3995 END PROC
4000 PROC K0
4010 COLOUR,F0:PRINTATS,Z)"@@"ATS,Z+1)"@@";
4020 END PROC
4030 PROC K1
4040 COLOUR,F1:PRINTATS,Z)"KE"ATS,Z+1)"L ";
4050 END PROC
4060 PROC K2
4070 COLOUR,F2:PRINTATS,Z)"AB"ATS,Z+1)"BA";
4080 END PROC
4090 PROC K3
4100 COLOUR,F3:PRINTATS,Z)"GH"ATS,Z+1)"IJ";
4110 END PROC
4120 PROC K4
4130 COLOUR,F4:PRINTATS,Z)"MO"ATS,Z+1)"NK";
4140 END PROC
4150 PROC K5
4160 COLOUR,F5:PRINTATS,Z)"QQ"ATS,Z+1)"QQ";
4170 END PROC
4180 PROC K6
4190 COLOUR,F6:PRINTATS,Z)" R"ATS,Z+1)"PM";
4200 END PROC
4210 PROC K7
4220 COLOUR,F7:PRINTATS,Z)"KE"ATS,Z+1)"OP";
4230 END PROC
4240 PROC K8
4250 COLOUR,F8:PRINTATS,Z)"KN"ATS,Z+1)"LR";
4260 END PROC
4270 PROC K9
4280 COLOUR,FS:PRINTATS,Z)"ST"ATS,Z+1)"UV";
4290 END PROC
4300 PROC KA
4310 COLOUR,FA:PRINTATS,Z)"KN";
4320 IFZ=23ANDS=38THENFILLZ+1,S,2,1,224,FA:END PROC
4330 PRINTATS,Z+1)"OM";
4340 END PROC
4500 PROC FINALE
4510 FILL0,0,40,25,224,FB:R$=DUP(CHR$($DF),9):R$=INST(" ",R$,4)
4520 INSERTR$,7,10,20,11,12:PRINTAT0,9)"";:CENTRE"ÁÌÌ ÆÉÎÉÓÈÅÄ!"
4530 PRINTAT0,LIN+2)"";:CENTRE"ÃÏÎÇÒÁÔÕÌÁÔÉÏÎÓ!"
4540 PRINTAT0,LIN+3)"";:CENTRE"ÖÉÓÉÔ"
4550 PRINTAT0,LIN+1)"";:CENTRE"ÍÁÔÈÅÍÁÔÉË.ÃÈ":COLOURFB,FB,FB
4560 BFLASH30,FB,12:PAUSE10:BFLASHOFF:COLOUR,12
4570 X$="X":NRM:DIV
4580 END PROC
5500 PROC INIT
5520 PRINT"";:FB=11:FS=5:F0=15:F1=2:F2=15:F3=15:F4=6:F5=6:F6=2:F7=2:F8=2:FA=2
5530 COLOUR12,FB,12:READ N:DIM FD%(N)
5535 FORI=1TON:READFD%(I):NEXT
5540 IFPEEK(2)>0THENP=PEEK(2):IFP>NTHENFINALE:END PROC
5550 IFFD%(P)=0THENP=P+1:POKE2,P
5560 RESET FD%(P)
5570 PK=0:AL=0:IN=0:READ P,B,H,SY,SX:DIMF%(B,H),G%(B,H)
5575 OY=0:IFH=12THENOY=1
5580 OX=1:IFB=20THENOX=0
5585 Z=2-OY:S=OX
5590 FILL0,0,40,25,224,FB
5592 FELD
5595 END PROC
5600 REM"***********************************
5610 REM"*                                 *
5620 REM"*             SOKOBAN             *
5630 REM"*                                 *
5640 REM"*    TSB ADAPTION BY A. DETTKE    *
5650 REM"*                                 *
5660 REM"*  TAKEN FROM WWW.MATHEMATIK.CH   *
5670 REM"*                                 *
5680 REM"***********************************
5700 PROC DEBUG
5705 PRINT"" DUP(" ",36);
5710 PRINT"SM1"M1; ",M2"M2; ",M3"M3; ",Z"Z; ",S"S;
5720 END PROC
6000 DATA 10,6005,6120,6230,6340,6460,6590,6720,6850,6970,7090
6005 DATA 1,19,11,9,12
6007 REM" FELD NR, BREITE, HOEHE, STARTPUNKT: ZEILE, SPALTE IM FELD
6010 DATA 0,0,0,0,1,7,7,7,8,0,0,0,0,0,0,0,0,0,0
6020 DATA 0,0,0,0,8,2,2,2,8,0,0,0,0,0,0,0,0,0,0
6030 DATA 0,0,0,0,8,5,2,2,8,0,0,0,0,0,0,0,0,0,0
6040 DATA 0,0,1,7,10,2,2,5,7,8,0,0,0,0,0,0,0,0,0
6050 DATA 0,0,8,2,2,5,2,5,2,8,0,0,0,0,0,0,0,0,0
6060 DATA 1,7,10,2,8,2,1,8,2,8,0,0,0,1,7,7,7,7,8
6070 DATA 8,2,2,2,10,2,7,10,2,7,7,7,7,10,2,2,3,3,8
6080 DATA 8,2,5,2,2,5,2,2,2,2,2,2,2,2,2,2,3,3,8
6090 DATA 7,7,7,7,8,2,7,7,10,2,8,9,1,8,2,2,3,3,8
6100 DATA 0,0,0,0,8,2,2,2,2,2,1,7,7,7,7,7,7,7,10
6110 DATA 0,0,0,0,7,7,7,7,7,7,10,0,0,0,0,0,0,0,0
6120 DATA 2,14,10,5,8
6130 DATA 1,7,7,7,7,1,7,7,7,7,7,8,0,0
6140 DATA 8,3,3,2,2,8,2,2,2,2,2,7,7,8
6150 DATA 8,3,3,2,2,8,2,5,2,2,5,2,2,8
6160 DATA 8,3,3,2,2,10,5,7,7,8,8,2,2,8
6170 DATA 8,3,3,2,2,2,2,9,2,7,10,2,2,8
6180 DATA 8,3,3,2,2,8,2,8,2,2,5,2,7,8
6190 DATA 7,7,1,7,7,10,2,7,10,5,2,5,2,8
6200 DATA 0,0,8,2,5,2,2,5,2,5,2,5,2,8
6210 DATA 0,0,8,2,2,2,2,8,2,2,2,2,2,8
6220 DATA 0,0,7,7,7,7,7,7,7,7,7,7,7,10
6230 DATA 3,17,10,2,15
6240 DATA 0,0,0,0,0,0,0,0,1,7,7,7,7,7,7,8,0
6250 DATA 0,0,0,0,0,0,0,0,8,2,2,2,2,2,9,8,0
6260 DATA 0,0,0,0,0,0,0,0,8,2,5,10,5,2,1,10,0
6270 DATA 0,0,0,0,0,0,0,0,8,2,5,2,2,5,8,0,0
6280 DATA 0,0,0,0,0,0,0,0,1,10,5,2,5,2,8,0,0
6290 DATA 1,7,7,7,7,7,7,1,8,2,5,2,10,2,7,7,8
6300 DATA 8,3,3,3,3,2,2,7,10,2,5,2,2,5,2,2,8
6310 DATA 1,10,3,3,3,2,2,2,2,5,2,2,5,2,2,2,8
6320 DATA 8,3,3,3,3,2,2,1,7,7,7,7,7,7,7,7,10
6330 DATA 7,7,7,7,7,7,7,10,0,0,0,0,0,0,0,0,0
6340 DATA 6,12,11,2,10
6350 DATA 1,7,7,7,7,8,0,0,1,7,8,0
6360 DATA 8,3,3,2,2,8,0,1,10,9,7,8
6370 DATA 8,3,3,2,2,7,7,10,2,2,2,8
6380 DATA 8,3,3,2,2,2,2,2,5,5,2,8
6390 DATA 8,3,3,2,2,8,2,8,2,5,2,8
6400 DATA 8,3,3,1,7,10,2,8,2,5,2,8
6410 DATA 7,7,7,8,2,5,2,8,5,2,2,8
6420 DATA 0,0,0,8,2,2,5,10,2,5,2,8
6430 DATA 0,0,0,8,2,5,2,2,5,2,2,8
6440 DATA 0,0,0,8,2,2,1,8,2,2,2,8
6450 DATA 0,0,0,7,7,7,7,7,7,7,7,10
6460 DATA 7,13,12,3,6
6470 DATA 0,0,0,0,0,0,0,1,7,7,7,8,0
6480 DATA 0,1,7,1,7,7,1,8,2,2,2,7,8
6490 DATA 1,10,2,10,2,9,7,10,2,5,5,2,8
6500 DATA 8,2,2,2,2,5,2,2,2,2,2,2,8
6510 DATA 8,2,2,5,2,2,1,1,8,2,2,2,8
6520 DATA 1,7,10,2,7,1,1,1,10,5,7,1,10
6530 DATA 8,2,5,2,2,7,7,10,2,3,3,8,0
6540 DATA 8,2,5,2,5,2,5,2,3,3,3,8,0
6550 DATA 8,2,2,2,2,1,7,8,3,3,3,8,0
6560 DATA 8,2,5,5,2,8,0,8,3,3,3,8,0
6570 DATA 8,2,2,1,7,10,0,7,7,7,7,10,0
6580 DATA 7,7,7,10,0,0,0,0,0,0,0,0,0
6590 DATA 26,15,12,10,14
6600 DATA 0,1,7,7,1,7,7,1,1,1,1,1,7,7,7
6610 DATA 0,8,2,2,8,2,2,1,7,7,7,8,0,0,0
6620 DATA 1,10,2,2,8,2,2,8,3,3,3,7,7,8,0
6630 DATA 8,2,2,5,8,2,2,10,3,3,3,2,2,8,0
6640 DATA 8,2,5,2,8,5,5,2,3,3,3,2,2,8,0
6650 DATA 8,2,2,5,8,2,2,8,3,3,3,2,3,8,0
6660 DATA 8,2,2,2,10,2,5,7,7,7,7,7,7,7,8
6670 DATA 1,8,5,2,2,2,2,2,2,2,5,2,5,2,8
6680 DATA 7,8,2,2,8,2,2,5,5,2,8,2,2,2,8
6690 DATA 0,7,7,7,7,7,8,2,2,7,10,5,5,9,8
6700 DATA 0,0,0,0,0,0,8,2,2,2,2,2,2,1,10
6710 DATA 0,0,0,0,0,0,7,7,7,7,7,7,7,10,0
6720 DATA 33,15,12,11,5
6730 DATA 1,1,1,7,1,7,7,7,7,7,7,1,1,1,8
6740 DATA 1,1,10,3,8,2,2,2,2,2,2,1,7,7,8
6750 DATA 1,10,3,3,8,2,5,2,2,5,2,8,2,2,8
6760 DATA 8,3,3,3,10,2,7,10,2,5,2,10,2,2,8
6770 DATA 8,3,3,3,3,3,2,2,10,5,5,2,2,2,8
6780 DATA 1,8,3,3,3,3,5,2,2,2,2,8,5,2,8
6790 DATA 1,7,7,10,2,7,7,7,7,7,7,10,2,2,8
6800 DATA 8,2,2,2,5,2,2,2,2,2,2,2,2,1,8
6810 DATA 8,2,2,5,2,8,2,2,5,8,2,5,2,7,8
6820 DATA 8,2,5,7,7,8,2,5,2,8,2,5,5,2,8
6830 DATA 8,2,2,2,9,8,2,2,1,8,2,2,2,2,8
6840 DATA 7,7,7,7,7,7,7,7,7,7,7,7,7,7,10
6850 DATA 38,11,11,2,9
6860 DATA 0,0,0,0,0,0,1,7,7,8,0
6870 DATA 1,7,7,7,7,7,10,2,9,8,0
6880 DATA 8,2,2,2,2,2,5,2,2,8,0
6890 DATA 8,2,2,2,5,7,10,2,5,8,0
6900 DATA 7,8,5,10,3,3,3,10,2,8,0
6910 DATA 0,8,2,5,3,3,3,2,2,8,0
6920 DATA 0,8,2,10,3,2,3,8,2,7,8
6930 DATA 0,8,2,2,2,10,2,10,5,2,8
6940 DATA 0,8,5,2,2,5,2,2,2,2,8
6950 DATA 0,8,2,2,1,7,7,7,7,7,10
6960 DATA 0,7,7,7,10,0,0,0,0,0,0
6970 DATA 43,19,11,8,10
6980 DATA 0,0,0,0,0,0,0,0,1,7,7,1,7,7,8,0,0,0,0
6990 DATA 0,0,0,0,1,7,7,7,8,2,2,10,2,2,7,7,7,8,0
7000 DATA 0,0,0,0,8,2,2,2,10,2,2,2,5,2,2,2,2,8,0
7010 DATA 0,1,7,7,10,2,10,5,5,2,1,10,2,1,8,2,2,8,0
7020 DATA 1,10,2,2,2,2,2,2,8,2,10,2,2,8,10,2,7,7,8
7030 DATA 8,2,2,7,7,10,2,5,8,5,2,2,5,2,2,5,2,2,8
7040 DATA 8,3,3,3,2,2,2,2,10,2,1,8,2,2,8,2,2,2,8
7050 DATA 8,3,3,3,8,2,2,2,2,9,2,10,2,7,7,10,2,7,8
7060 DATA 8,3,3,3,8,2,2,1,7,8,2,2,5,2,2,2,5,2,8
7070 DATA 7,7,7,7,7,7,7,10,0,7,8,2,2,2,8,2,2,2,8
7080 DATA 0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,10
7090 DATA 47,18,11,6,8
7100 DATA 0,0,0,0,0,0,0,0,0,1,7,7,8,0,0,0,0,0
7110 DATA 0,1,7,7,7,7,7,7,7,10,2,2,7,8,0,0,0,0
7120 DATA 1,10,2,2,5,2,2,2,2,2,2,5,2,1,7,7,7,8
7130 DATA 8,2,2,2,7,10,2,7,10,2,2,2,1,8,3,3,3,8
7140 DATA 8,2,8,5,5,2,5,2,5,5,8,5,7,10,3,3,3,8
7150 DATA 8,2,10,2,2,2,2,9,2,2,10,2,2,2,3,3,3,8
7160 DATA 8,2,2,5,10,2,7,7,10,5,5,2,2,2,3,3,3,8
7170 DATA 8,2,5,2,2,5,5,2,2,5,2,1,8,3,3,3,3,8
7180 DATA 7,7,8,5,2,2,2,2,2,2,2,1,7,7,7,7,7,10
7190 DATA 0,0,8,2,2,1,7,7,7,7,7,10,0,0,0,0,0,0
7200 DATA 0,0,7,7,7,10,0,0,0,0,0,0,0,0,0,0,0,0
